   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 46.1/46.1 kB 2.6 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 244.0/244.0 kB 5.9 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 40.6/40.6 kB 1.5 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.6/1.6 MB 24.8 MB/s eta 0:00:00
✅ เปลี่ยน Directory แล้ว: /content/drive/MyDrive/new
============================= test session starts ==============================
platform linux -- Python 3.11.12, pytest-8.3.5, pluggy-1.5.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /content/drive/MyDrive/new
configfile: pytest.ini
plugins: cov-6.1.1, mock-3.14.0, xdist-3.6.1, langsmith-0.3.42, anyio-4.9.0, typeguard-4.4.2
collecting ... 
----------------------------- live log collection ------------------------------
03:48:10 [INFO] [numexpr.utils] NumExpr defaulting to 2 threads.
collected 105 items                                                            

test_gold_ai.py::TestGoldAIPart1SetupAndEnv::test_environment_is_colab_drive_mount_succeeds 03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 & 3] Initial StreamHandler for logger configured. FileHandler deferred to main().
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.62_FULL_PASS - Logger Initialized (Import Phase).
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] -    Running in Google Colab environment.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] -    Attempting to mount Google Drive...
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] -    Google Drive mounted successfully.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.62_FULL_PASS
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:11 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:11 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
03:48:11 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 10 (Original Part 9): Walk-Forward Orchestration & Analysis Functions (Fuller Logic v4.9.18 - Corrected WFV Type Hint) Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 11 (Original Part 10): Main Execution & Pipeline Control Loaded and Refactored with Full Data/Model Logic.
03:48:11 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:11 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:11 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:11 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
PASSED
test_gold_ai.py::TestGoldAI2025::test_all_module_functions_present 03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.62_FULL_PASS - Logger Initialized (Import Phase).
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] -    Not running in Google Colab environment (get_ipython is None).
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.62_FULL_PASS
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log setup --------------------------------
03:48:11 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:11 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:11 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
03:48:11 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 10 (Original Part 9): Walk-Forward Orchestration & Analysis Functions (Fuller Logic v4.9.18 - Corrected WFV Type Hint) Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 11 (Original Part 10): Main Execution & Pipeline Control Loaded and Refactored with Full Data/Model Logic.
03:48:11 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:11 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:11 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:11 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
PASSED
test_gold_ai.py::TestGoldAI2025::test_check_kill_switch_logic 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:11 [DEBUG] [test_kill._check_kill_switch] Checking Kill Switch at 2021-01-01 00:00:00: Equity=80.00, Peak=100.00, DDThresh=10.00%, ConsLossThresh=5, CurrentConsLoss=0, ActiveStatus=False
03:48:11 [CRITICAL] [test_kill._check_kill_switch] [KILL SWITCH - DD] Triggered at 2021-01-01 00:00:00. DD=20.00% >= Threshold=10.00%. Equity=80.00, Peak=100.00
03:48:11 [INFO] [test_kill._check_kill_switch] Kill Switch newly activated at 2021-01-01 00:00:00 (DD: True, ConsLoss: False).
03:48:11 [DEBUG] [test_kill._check_kill_switch] Kill Switch check result: TriggeredNow=True, NewActiveStatus=True
03:48:11 [DEBUG] [test_kill._check_kill_switch] Checking Kill Switch at 2021-01-01 00:00:00: Equity=100.00, Peak=100.00, DDThresh=50.00%, ConsLossThresh=3, CurrentConsLoss=4, ActiveStatus=False
03:48:11 [CRITICAL] [test_kill._check_kill_switch] [KILL SWITCH - CONSECUTIVE LOSS] Triggered at 2021-01-01 00:00:00. Losses=4 >= Threshold=3.
03:48:11 [INFO] [test_kill._check_kill_switch] Kill Switch newly activated at 2021-01-01 00:00:00 (DD: False, ConsLoss: True).
03:48:11 [DEBUG] [test_kill._check_kill_switch] Kill Switch check result: TriggeredNow=True, NewActiveStatus=True
03:48:11 [DEBUG] [test_kill._check_kill_switch] Checking Kill Switch at 2021-01-01 00:00:00: Equity=90.00, Peak=100.00, DDThresh=50.00%, ConsLossThresh=5, CurrentConsLoss=1, ActiveStatus=False
03:48:11 [DEBUG] [test_kill._check_kill_switch] Kill Switch check result: TriggeredNow=False, NewActiveStatus=False
PASSED
test_gold_ai.py::TestGoldAI2025::test_check_margin_call 
-------------------------------- live log call ---------------------------------
03:48:11 [CRITICAL] [gold_ai2025.check_margin_call] [MARGIN CALL] Current equity (-1.00) is at or below margin call level (0.00).
03:48:11 [CRITICAL] [gold_ai2025.check_margin_call] [MARGIN CALL] Current equity (5.00) is at or below margin call level (5.00).
PASSED
test_gold_ai.py::TestGoldAI2025::test_library_already_imported 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.log_library_version] (Info) Using BAZ version: 1.0
PASSED
test_gold_ai.py::TestGoldAI2025::test_library_import_fails_install_succeeds 
-------------------------------- live log call ---------------------------------
03:48:11 [WARNING] [gold_ai2025.try_import_with_install] ไม่พบ Library: BAR. กำลังพยายามติดตั้ง...
03:48:11 [INFO] [gold_ai2025.try_import_with_install]    ติดตั้ง BAR สำเร็จ (pip stdout): <MagicMock name='run().stdout.__getitem__()' id='132256312717200'>...
03:48:11 [INFO] [gold_ai2025.try_import_with_install] [Patch] Successfully installed and imported BAR version: 0.2
PASSED
test_gold_ai.py::TestGoldAI2025::test_load_app_config_not_found 
-------------------------------- live log call ---------------------------------
03:48:11 [WARNING] [gold_ai2025.load_app_config] Function 'load_app_config' is DEPRECATED. Use 'load_config_from_yaml' with StrategyConfig instead.
03:48:11 [ERROR] [gold_ai2025.load_app_config]    (Config Error) Configuration file 'nofile.json' not found. Using default script values.
PASSED
test_gold_ai.py::TestGoldAI2025::test_load_app_config_success 
-------------------------------- live log call ---------------------------------
03:48:11 [WARNING] [gold_ai2025.load_app_config] Function 'load_app_config' is DEPRECATED. Use 'load_config_from_yaml' with StrategyConfig instead.
03:48:11 [INFO] [gold_ai2025.load_app_config]    (Config) Successfully loaded configuration from: /content/drive/MyDrive/new/cfg.json
PASSED
test_gold_ai.py::TestGoldAI2025::test_load_config_from_yaml 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.load_config_from_yaml] Successfully loaded configuration from: dummy.yaml
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.02, 'max_lot': 2.0}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.020, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
PASSED
test_gold_ai.py::TestGoldAI2025::test_log_library_version_info PASSED
test_gold_ai.py::TestGoldAI2025::test_log_library_version_none PASSED
test_gold_ai.py::TestGoldAI2025::test_minimal_test_function PASSED
test_gold_ai.py::TestGoldAI2025::test_print_gpu_utilization_and_show_system_status PASSED
test_gold_ai.py::TestGoldAI2025::test_risk_manager_consecutive_loss_and_trading_allowed 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:11 [INFO] [gold_ai2025.RiskManager] RiskManager initialized. Hard Kill DD: 20.00%, Soft Kill DD: 15.00%
03:48:11 [CRITICAL] [gold_ai2025.RiskManager] [RISK - KILL SWITCH] Consecutive Losses Threshold Hit. Losses=7 >= Threshold=7
03:48:11 [DEBUG] [gold_ai2025.RiskManager] [RISK] Trading blocked: Soft Kill Switch is active.
PASSED
test_gold_ai.py::TestGoldAI2025::test_risk_manager_drawdown_and_kill_switch 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:11 [INFO] [gold_ai2025.RiskManager] RiskManager initialized. Hard Kill DD: 20.00%, Soft Kill DD: 15.00%
03:48:11 [INFO] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+] Drawdown peak initialized to 100.00
03:48:11 [INFO] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+] Drawdown updated: Equity=100.00, Peak=100.00, DD=0.0000
03:48:11 [INFO] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+] Drawdown updated: Equity=90.00, Peak=100.00, DD=0.1000
03:48:11 [INFO] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+] Drawdown updated: Equity=85.00, Peak=100.00, DD=0.1500
03:48:11 [CRITICAL] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+][RISK] Soft Kill ACTIVATED: DD=0.1500 >= 0.1500
03:48:11 [INFO] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+] Drawdown updated: Equity=79.00, Peak=100.00, DD=0.2100
03:48:11 [CRITICAL] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.59+][Patch] [RISK - KILL SWITCH] Max Drawdown Triggered! EQ=79.00, Peak=100.00, DD=0.2100 >= 0.2000
PASSED
test_gold_ai.py::TestGoldAI2025::test_risk_manager_soft_kill_active 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:11 [INFO] [gold_ai2025.RiskManager] RiskManager initialized. Hard Kill DD: 20.00%, Soft Kill DD: 15.00%
03:48:11 [INFO] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+] Drawdown updated: Equity=80.00, Peak=100.00, DD=0.2000
03:48:11 [CRITICAL] [gold_ai2025.RiskManager] [Patch AI Studio v4.9.58+][RISK] Soft Kill ACTIVATED: DD=0.2000 >= 0.1500
PASSED
test_gold_ai.py::TestGoldAI2025::test_safe_get_global PASSED
test_gold_ai.py::TestGoldAI2025::test_safe_load_csv_auto 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.safe_load_csv_auto]       (safe_load) Attempting to load: missing.csv
03:48:11 [ERROR] [gold_ai2025.safe_load_csv_auto]          (Error) ไม่พบไฟล์: missing.csv
03:48:11 [INFO] [gold_ai2025.safe_load_csv_auto]       (safe_load) Attempting to load: data.csv
03:48:11 [DEBUG] [gold_ai2025.safe_load_csv_auto]          -> No .gz extension, using standard pd.read_csv.
03:48:11 [INFO] [gold_ai2025.safe_load_csv_auto]       (safe_load) Attempting to load: data.csv.gz
03:48:11 [DEBUG] [gold_ai2025.safe_load_csv_auto]          -> Detected .gz extension, using gzip.
PASSED
test_gold_ai.py::TestGoldAI2025::test_set_thai_font_and_setup_fonts 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.set_thai_font]    [Font Check] Searching for preferred fonts: ['Loma', 'TH Sarabun New', 'THSarabunNew', 'Garuda', 'Norasi', 'Kinnari', 'Waree', 'Laksaman']
03:48:11 [INFO] [gold_ai2025.set_thai_font]       -> Found font: 'Loma' (requested: 'Loma') at path: /tmp/font.ttf
03:48:11 [INFO] [gold_ai2025.set_thai_font]    Attempting to set default font to 'Loma'.
03:48:11 [INFO] [gold_ai2025.set_thai_font]       -> Font 'Loma' set and tested successfully.
03:48:11 [INFO] [gold_ai2025.setup_fonts] 
(Processing) Setting up Thai font for plots...
03:48:11 [INFO] [gold_ai2025.setup_fonts]    Attempting to set font directly using findfont...
03:48:11 [INFO] [gold_ai2025.set_thai_font]    [Font Check] Searching for preferred fonts: ['TH Sarabun New', 'THSarabunNew', 'Garuda', 'Norasi', 'Kinnari', 'Waree', 'Laksaman', 'Loma']
03:48:11 [INFO] [gold_ai2025.set_thai_font]       -> Found font: 'Loma' (requested: 'TH Sarabun New') at path: /tmp/font.ttf
03:48:11 [INFO] [gold_ai2025.set_thai_font]    Attempting to set default font to 'Loma'.
03:48:11 [INFO] [gold_ai2025.set_thai_font]       -> Font 'Loma' set and tested successfully.
03:48:11 [INFO] [gold_ai2025.setup_fonts] 
   (Info) Font setup process complete.
PASSED
test_gold_ai.py::TestGoldAI2025::test_setup_output_directory 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.setup_output_directory]    (Setup) กำลังตรวจสอบ/สร้าง Output Directory: /tmp/outdir
03:48:11 [INFO] [gold_ai2025.setup_output_directory]       -> Directory exists or was created.
03:48:11 [INFO] [gold_ai2025.setup_output_directory]       -> การเขียนไฟล์ทดสอบสำเร็จ.
PASSED
test_gold_ai.py::TestGoldAI2025::test_should_exit_due_to_holding PASSED
test_gold_ai.py::TestGoldAI2025::test_simple_converter 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.simple_converter] Type <class 'object'> not directly serializable. Converting to string: '<object object at 0x784962f8a7b0>...'
PASSED
test_gold_ai.py::TestGoldAI2025::test_spike_guard_and_reentry 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:11 [INFO] [GoldAI_UnitTest] [Patch AI Studio v4.9.58+] spike_guard_blocked INPUT: session=London, row={'spike_score': 0.6, 'Pattern_Label': 'Breakout'}, cfg.threshold=0.50, allowed=['Breakout']
03:48:11 [INFO] [GoldAI.SpikeGuard] [Patch AI Studio v4.9.58+] Checking spike guard: session=London, score=0.6, threshold=0.5, pattern=Breakout, allowed_patterns=['Breakout']
03:48:11 [WARNING] [GoldAI.SpikeGuard] [Patch AI Studio v4.9.58+] Spike guard blocked! session=London, score=0.6, pattern=Breakout
03:48:11 [INFO] [GoldAI_UnitTest] [Patch AI Studio v4.9.58+] spike_guard_blocked OUTPUT: True
03:48:11 [INFO] [GoldAI.SpikeGuard] [Patch AI Studio v4.9.58+] Checking spike guard: session=Asia, score=0.6, threshold=0.5, pattern=Breakout, allowed_patterns=['Breakout']
03:48:11 [INFO] [GoldAI.SpikeGuard] [Patch AI Studio v4.9.58+] Spike guard allowed: session=Asia, score=0.6, pattern=Breakout
03:48:11 [INFO] [GoldAI_UnitTest] [Patch AI Studio v4.9.58+] spike_guard_blocked (Asia) OUTPUT: False
03:48:11 [DEBUG] [gold_ai2025.is_reentry_allowed.BUY] Re-entry blocked: Cooldown active. Bars since last trade (1) < Cooldown (3).
03:48:11 [INFO] [gold_ai2025.is_reentry_allowed.BUY] Re-entry ALLOWED for side BUY at 2021-01-01 00:15:00.
PASSED
test_gold_ai.py::TestGoldAI2025::test_strategy_config_defaults 
-------------------------------- live log call ---------------------------------
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:11 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:11 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
PASSED
test_gold_ai.py::TestGoldAI2025::test_try_import_with_install_success 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.log_library_version] (Info) Using FOO version: 0.1
PASSED
test_gold_ai.py::TestEdgeCases::test_calculate_metrics_basic 03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.62_FULL_PASS - Logger Initialized (Import Phase).
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] -    Not running in Google Colab environment (get_ipython is None).
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.62_FULL_PASS
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log setup --------------------------------
03:48:11 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:11 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:11 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
03:48:11 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:11 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 10 (Original Part 9): Walk-Forward Orchestration & Analysis Functions (Fuller Logic v4.9.18 - Corrected WFV Type Hint) Loaded and Refactored.
03:48:11 - INFO - [GoldAI_Enterprise_v4.9] - Part 11 (Original Part 10): Main Execution & Pipeline Control Loaded and Refactored with Full Data/Model Logic.
03:48:11 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:11 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:11 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:11 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
-------------------------------- live log call ---------------------------------
03:48:11 [WARNING] [gold_ai2025.calculate_metrics_basic] [Patch AI Studio v4.9.56+] Extra kwargs ignored in calculate_metrics: ['side']
03:48:11 [DEBUG] [gold_ai2025.calculate_metrics_basic] Metrics calculated for fold 'test': {'fold_tag': 'test', 'num_trades': 3, 'num_tp': 1, 'num_sl': 1, 'num_be': 1, 'net_profit': 10.0}
PASSED
test_gold_ai.py::TestEdgeCases::test_dummy_module_behavior PASSED
test_gold_ai.py::TestEdgeCases::test_load_data_missing_columns 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.load_data] (Loading) กำลังโหลดข้อมูล  จาก: /tmp/tmpkayxwrm0/invalid.csv
03:48:11 [INFO] [gold_ai2025.load_data]    ไฟล์ข้อมูล: /tmp/tmpkayxwrm0/invalid.csv
03:48:11 [CRITICAL] [gold_ai2025.load_data] (Error) ขาดคอลัมน์ที่จำเป็น: ['Close', 'Low', 'Timestamp']
03:48:11 [CRITICAL] [gold_ai2025.load_data] (Error) ไม่สามารถโหลดข้อมูล : ขาดคอลัมน์ที่จำเป็น
Traceback (most recent call last):
  File "/content/drive/MyDrive/new/gold_ai2025.py", line 1564, in load_data
    load_data_logger.critical(f"(Error) ขาดคอลัมน์ที่จำเป็น: {missing_req}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
gold_ai2025.DataLoadError: ขาดคอลัมน์ที่จำเป็น
Traceback (most recent call last):
  File "/content/drive/MyDrive/new/gold_ai2025.py", line 1564, in load_data
    load_data_logger.critical(f"(Error) ขาดคอลัมน์ที่จำเป็น: {missing_req}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
gold_ai2025.DataLoadError: ขาดคอลัมน์ที่จำเป็น
PASSED
test_gold_ai.py::TestEdgeCases::test_load_data_missing_file 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.load_data] (Loading) กำลังโหลดข้อมูล  จาก: /tmp/tmppyjujv8w/no_such_file.csv
03:48:11 [CRITICAL] [gold_ai2025.load_data] (Error) ไม่พบไฟล์ข้อมูล
PASSED
test_gold_ai.py::TestEdgeCases::test_load_data_valid 
-------------------------------- live log call ---------------------------------
03:48:11 [INFO] [gold_ai2025.load_data] (Loading) กำลังโหลดข้อมูล  จาก: /tmp/tmpgwse47m8/valid.csv
03:48:11 [INFO] [gold_ai2025.load_data]    ไฟล์ข้อมูล: /tmp/tmpgwse47m8/valid.csv
03:48:11 [DEBUG] [gold_ai2025.load_data]    Converting price columns ['Open', 'High', 'Low', 'Close'] to numeric (if not already specified in dtypes)...
03:48:11 [DEBUG] [gold_ai2025.load_data]    [Data Quality] Checking for invalid prices (<= 0)...
03:48:11 [DEBUG] [gold_ai2025.load_data]    [Data Quality] Checking High >= Low consistency...
03:48:11 [INFO] [gold_ai2025.load_data]    [Data Quality] ตรวจสอบ % NaN ในคอลัมน์ราคา...
03:48:11 [INFO] [gold_ai2025.load_data]       NaN Percentage:
Open     0.0
High     0.0
Low      0.0
Close    0.0
dtype: float64
03:48:11 [INFO] [gold_ai2025.load_data]    [Data Quality] ตรวจสอบ Duplicates (Date & Timestamp)...
03:48:11 [DEBUG] [gold_ai2025.load_data]       ไม่พบ Duplicates (Date & Timestamp).
03:48:11 [INFO] [gold_ai2025.load_data]    [Data Quality] ตรวจสอบ Price Jumps (Threshold > 10.0%)...
03:48:11 [WARNING] [gold_ai2025.load_data]    (Warning) พบ 1 แท่งที่มีการเปลี่ยนแปลงราคา Close เกิน 10.0%:
03:48:11 [WARNING] [gold_ai2025.load_data]       ตัวอย่าง Index และ % Change:
2    0.25
03:48:12 [INFO] [gold_ai2025.load_data] (Success) โหลดและตรวจสอบข้อมูล  สำเร็จ: 3 แถว
PASSED
test_gold_ai.py::TestEdgeCases::test_log_library_version_none_and_missing 
-------------------------------- live log call ---------------------------------
03:48:12 [WARNING] [gold_ai2025.log_library_version] Library DUMMY_NONE is None (likely not imported or import failed).
03:48:12 [DEBUG] [gold_ai2025.log_library_version] [DEBUG] Version attribute for library DUMMY_MISSING is 'N/A' or None.
PASSED
test_gold_ai.py::TestEdgeCases::test_prepare_datetime_all_nat 
-------------------------------- live log call ---------------------------------
03:48:12 [INFO] [gold_ai2025.prepare_datetime] (Processing) กำลังเตรียม Datetime Index (ALL_NAT_TEST)...
03:48:12 [WARNING] [gold_ai2025.prepare_datetime]    StrategyConfig not provided or missing 'max_nat_ratio_threshold'. Using default: 0.05
03:48:12 [INFO] [gold_ai2025.preview_datetime_format]    [Preview] First 5 Date + Timestamp format examples:
03:48:12 [INFO] [gold_ai2025.preview_datetime_format] 
0000 99:99:99
0000 99:99:99
0000 99:99:99
0000 99:99:99
0000 99:99:99
03:48:12 [INFO] [gold_ai2025.prepare_datetime]       [Converter] กำลังตรวจสอบและแปลงปี พ.ศ. เป็น ค.ศ. (ถ้าจำเป็น)...
03:48:12 [INFO] [gold_ai2025.prepare_datetime]       [Converter] ไม่พบปีที่น่าจะเป็น พ.ศ. (หรือข้อมูลน้อยเกินไป).
03:48:12 [DEBUG] [gold_ai2025.prepare_datetime]       Combining Date and Timestamp strings...
03:48:12 [INFO] [gold_ai2025.parse_datetime_safely]       [Parser] Attempting to parse date/time strings...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%Y%m%d %H:%M:%S' for 5 values...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%Y%m%d%H:%M:%S' for 5 values...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%Y-%m-%d %H:%M:%S' for 5 values...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%Y/%m/%d %H:%M:%S' for 5 values...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%Y.%m.%d %H:%M:%S' for 5 values...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%d/%m/%Y %H:%M:%S' for 5 values...
03:48:12 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%m/%d/%Y %H:%M:%S' for 5 values...
03:48:12 [INFO] [gold_ai2025.parse_datetime_safely]       [Parser] Trying general parser for 5 remaining values...
03:48:12 [WARNING] [gold_ai2025.parse_datetime_safely]       [Parser] Could not parse 5 date/time strings.
03:48:12 [WARNING] [gold_ai2025.parse_datetime_safely]          Example failed strings:
0    0000 99:99:99
1    0000 99:99:99
2    0000 99:99:99
3    0000 99:99:99
4    0000 99:99:99
03:48:12 [INFO] [gold_ai2025.parse_datetime_safely]       [Parser] (Finished) Date/time parsing complete.
03:48:13 [WARNING] [gold_ai2025.prepare_datetime]    (Warning) พบค่า NaT 5 (100.0%) ใน ALL_NAT_TEST หลังการ parse.
03:48:13 [CRITICAL] [gold_ai2025.prepare_datetime]    (Error) พบค่า NaT 100% ใน ALL_NAT_TEST. ไม่สามารถดำเนินการต่อได้. ตัวอย่าง: 0000 99:99:99
PASSED
test_gold_ai.py::TestEdgeCases::test_prepare_datetime_duplicate_index 
-------------------------------- live log call ---------------------------------
03:48:13 [INFO] [gold_ai2025.prepare_datetime] (Processing) กำลังเตรียม Datetime Index (DUP)...
03:48:13 [WARNING] [gold_ai2025.prepare_datetime]    StrategyConfig not provided or missing 'max_nat_ratio_threshold'. Using default: 0.05
03:48:13 [INFO] [gold_ai2025.preview_datetime_format]    [Preview] First 5 Date + Timestamp format examples:
03:48:13 [INFO] [gold_ai2025.preview_datetime_format] 
20240101 00:00:00
20240101 00:00:00
03:48:13 [INFO] [gold_ai2025.prepare_datetime]       [Converter] กำลังตรวจสอบและแปลงปี พ.ศ. เป็น ค.ศ. (ถ้าจำเป็น)...
03:48:13 [INFO] [gold_ai2025.prepare_datetime]       [Converter] ไม่พบปีที่น่าจะเป็น พ.ศ. (หรือข้อมูลน้อยเกินไป).
03:48:13 [DEBUG] [gold_ai2025.prepare_datetime]       Combining Date and Timestamp strings...
03:48:13 [INFO] [gold_ai2025.parse_datetime_safely]       [Parser] Attempting to parse date/time strings...
03:48:13 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] Trying format: '%Y%m%d %H:%M:%S' for 2 values...
03:48:13 [INFO] [gold_ai2025.parse_datetime_safely]       [Parser] (Success) Format '%Y%m%d %H:%M:%S' matched: 2. Remaining: 0
03:48:13 [DEBUG] [gold_ai2025.parse_datetime_safely]       [Parser] All strings parsed.
03:48:13 [INFO] [gold_ai2025.parse_datetime_safely]       [Parser] (Finished) Date/time parsing complete.
03:48:13 [DEBUG] [gold_ai2025.prepare_datetime]    ไม่พบค่า NaT ใน DUP หลังการ parse.
03:48:13 [WARNING] [gold_ai2025.prepare_datetime]    (Warning) พบ Index ซ้ำ 1 รายการ. กำลังลบรายการซ้ำ (เก็บรายการแรก)...
03:48:13 [INFO] [gold_ai2025.prepare_datetime]    แก้ไข index ซ้ำ: ลบ 1 แถว.
03:48:13 [DEBUG] [gold_ai2025.prepare_datetime]    Checking for non-monotonic index (time reversals)...
03:48:13 [DEBUG] [gold_ai2025.prepare_datetime]       Index is monotonic increasing.
03:48:13 [INFO] [gold_ai2025.prepare_datetime] (Success) เตรียม Datetime index (DUP) สำเร็จ. Shape: (1, 7)
PASSED
test_gold_ai.py::TestEdgeCases::test_run_backtest_simulation_v34_minimal 
-------------------------------- live log call ---------------------------------
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:13 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] --- Starting Backtest Simulation (v4.9.23 - AI Studio Patch v4.9.1): Label='Minimal', Side='BUY', Fold=N/A ---
03:48:13 [WARNING] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] RiskManager (risk_manager_obj) not provided. Initializing new one.
03:48:13 [INFO] [gold_ai2025.RiskManager] RiskManager initialized. Hard Kill DD: 20.00%, Soft Kill DD: 15.00%
03:48:13 [WARNING] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] TradeManager (trade_manager_obj) not provided. Initializing new one.
03:48:13 [INFO] [gold_ai2025.TradeManager] TradeManager initialized. FE Cooldown: 240 min, FE Score: 1.0, FE Max Losses: 2
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Patch AI Studio v4.9.62+] Equity tracker history initialized as dict
03:48:13 [DEBUG] [gold_ai2025._predefine_result_columns_for_simulation] Predefining result columns in df_sim for label_suffix: _Minimal
03:48:13 [DEBUG] [gold_ai2025._predefine_result_columns_for_simulation] Finished predefining 44 columns for _Minimal.
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] Initializing simulation. Capital: $1000.00, Risk: 1.000%, MM Mode: balanced
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] Config: MaxHold=24, PTP En=True, ReEn=True, FE En=True
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] Initial KillSwitchState=False, InitialConsecLosses=0
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] Simulation loop finished for Minimal. Finalizing remaining orders...
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] Created trade log DataFrame for Minimal with 0 entries.
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY]   (Finished) Minimal (BUY) simulation complete. Final Equity: $1000.00
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Patch AI Studio v4.9.62+] Fold summary: final equity=1000.00, len(history)=2, trade_log=0
PASSED
test_gold_ai.py::TestEdgeCases::test_run_backtest_simulation_v34_return_tuple 
-------------------------------- live log call ---------------------------------
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {}
03:48:13 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] --- Starting Backtest Simulation (v4.9.23 - AI Studio Patch v4.9.1): Label='Minimal', Side='BUY', Fold=N/A ---
03:48:13 [WARNING] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] RiskManager (risk_manager_obj) not provided. Initializing new one.
03:48:13 [INFO] [gold_ai2025.RiskManager] RiskManager initialized. Hard Kill DD: 20.00%, Soft Kill DD: 15.00%
03:48:13 [WARNING] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] TradeManager (trade_manager_obj) not provided. Initializing new one.
03:48:13 [INFO] [gold_ai2025.TradeManager] TradeManager initialized. FE Cooldown: 240 min, FE Score: 1.0, FE Max Losses: 2
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Patch AI Studio v4.9.62+] Equity tracker history initialized as dict
03:48:13 [DEBUG] [gold_ai2025._predefine_result_columns_for_simulation] Predefining result columns in df_sim for label_suffix: _Minimal
03:48:13 [DEBUG] [gold_ai2025._predefine_result_columns_for_simulation] Finished predefining 44 columns for _Minimal.
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] Initializing simulation. Capital: $1000.00, Risk: 1.000%, MM Mode: balanced
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] Config: MaxHold=24, PTP En=True, ReEn=True, FE En=True
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Minimal] Initial KillSwitchState=False, InitialConsecLosses=0
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] Simulation loop finished for Minimal. Finalizing remaining orders...
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] Created trade log DataFrame for Minimal with 0 entries.
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY]   (Finished) Minimal (BUY) simulation complete. Final Equity: $1000.00
03:48:13 [INFO] [gold_ai2025.run_backtest_simulation_v34.Minimal.BUY] [Patch AI Studio v4.9.62+] Fold summary: final equity=1000.00, len(history)=1, trade_log=0
PASSED
test_gold_ai.py::TestEdgeCases::test_safe_load_csv_auto_empty_file 
-------------------------------- live log call ---------------------------------
03:48:13 [INFO] [gold_ai2025.safe_load_csv_auto]       (safe_load) Attempting to load: empty.csv
03:48:13 [DEBUG] [gold_ai2025.safe_load_csv_auto]          -> No .gz extension, using standard pd.read_csv.
03:48:13 [WARNING] [gold_ai2025.safe_load_csv_auto]          (Warning) File is empty: empty.csv
PASSED
test_gold_ai.py::TestEdgeCases::test_safe_load_csv_auto_gz_corrupt 
-------------------------------- live log call ---------------------------------
03:48:13 [INFO] [gold_ai2025.safe_load_csv_auto]       (safe_load) Attempting to load: corrupt.csv.gz
03:48:13 [DEBUG] [gold_ai2025.safe_load_csv_auto]          -> Detected .gz extension, using gzip.
03:48:13 [ERROR] [gold_ai2025.safe_load_csv_auto]          (Error) Failed to load file 'corrupt.csv.gz': gzip error
Traceback (most recent call last):
  File "/content/drive/MyDrive/new/gold_ai2025.py", line 1391, in safe_load_csv_auto
    load_logger.debug("         -> Detected .gz extension, using gzip.")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/unittest/mock.py", line 1124, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
    raise effect
OSError: gzip error
PASSED
test_gold_ai.py::TestEdgeCases::test_safe_load_csv_auto_invalid_path_type 
-------------------------------- live log call ---------------------------------
03:48:13 [ERROR] [gold_ai2025.safe_load_csv_auto]          (Error) Invalid file path provided to safe_load_csv_auto.
03:48:13 [ERROR] [gold_ai2025.safe_load_csv_auto]          (Error) Invalid file path provided to safe_load_csv_auto.
PASSED
test_gold_ai.py::TestEdgeCases::test_set_thai_font_fallback_no_match 
-------------------------------- live log call ---------------------------------
03:48:13 [INFO] [gold_ai2025.set_thai_font]    [Font Check] Searching for preferred fonts: ['NoFont', 'TH Sarabun New', 'THSarabunNew', 'Garuda', 'Norasi', 'Kinnari', 'Waree', 'Laksaman', 'Loma']
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'NoFont' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'TH Sarabun New' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'THSarabunNew' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'Garuda' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'Norasi' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'Kinnari' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'Waree' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'Laksaman' not found by findfont.
03:48:13 [DEBUG] [gold_ai2025.set_thai_font]       -> Font 'Loma' not found by findfont.
03:48:13 [WARNING] [gold_ai2025.set_thai_font]    (Warning) Could not find any suitable Thai fonts (['NoFont', 'TH Sarabun New', 'THSarabunNew', 'Garuda', 'Norasi', 'Kinnari', 'Waree', 'Laksaman', 'Loma']) using findfont.
PASSED
test_gold_ai.py::TestEdgeCases::test_setup_output_directory_permission_error 
-------------------------------- live log call ---------------------------------
03:48:13 [INFO] [gold_ai2025.setup_output_directory]    (Setup) กำลังตรวจสอบ/สร้าง Output Directory: /root/unwritable
03:48:13 [ERROR] [gold_ai2025.setup_output_directory]    (Error) ไม่สามารถสร้างหรือเข้าถึง Output Directory '/root/unwritable': Read-only file system
Traceback (most recent call last):
  File "/content/drive/MyDrive/new/gold_ai2025.py", line 1245, in setup_output_directory
    try:
        ^
  File "/usr/lib/python3.11/unittest/mock.py", line 1124, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
    raise effect
PermissionError: Read-only file system
PASSED
test_gold_ai.py::TestEdgeCases::test_simple_converter_edge_cases 
-------------------------------- live log call ---------------------------------
03:48:13 [DEBUG] [gold_ai2025.simple_converter] Type <class 'set'> not directly serializable. Converting to string: '{1, 2}...'
03:48:13 [DEBUG] [gold_ai2025.simple_converter] Type <class 'complex'> not directly serializable. Converting to string: '(2+3j)...'
PASSED
test_gold_ai.py::TestEdgeCases::test_simulate_trades_minimal 
-------------------------------- live log call ---------------------------------
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01}
03:48:13 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:13 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:13 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1800.0, Exit:1795.0, PNL:0.0
03:48:13 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestEdgeCases::test_simulate_trades_tp1_sl 
-------------------------------- live log call ---------------------------------
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01}
03:48:14 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:14 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:14 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999.0, PNL:0.0
03:48:14 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestEdgeCases::test_simulate_trades_tsl_behavior 
-------------------------------- live log call ---------------------------------
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'use_tsl': True, 'trailing_sl_distance': 1.5}
03:48:15 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:15 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:15 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:15 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestEdgeCases::test_strategy_config_custom_values 
-------------------------------- live log call ---------------------------------
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.02, 'max_lot': 10.0, 'kill_switch_dd': 0.25, 'enable_spike_guard': False}
03:48:16 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.020, Max Hold: 24 bars, Kill DD: 25.00%
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
PASSED
test_gold_ai.py::TestEdgeCases::test_try_import_install_success_no_version 
-------------------------------- live log call ---------------------------------
03:48:16 [WARNING] [gold_ai2025.try_import_with_install] ไม่พบ Library: NOVERS. กำลังพยายามติดตั้ง...
03:48:16 [INFO] [gold_ai2025.try_import_with_install]    ติดตั้ง NOVERS สำเร็จ (pip stdout): <MagicMock name='run().stdout.__getitem__()' id='132256303566352'>...
03:48:16 [INFO] [gold_ai2025.try_import_with_install] [Patch] Successfully installed and imported NOVERS.
PASSED
test_gold_ai.py::TestWFVandLotSizing::test_calculate_lot_by_fund_mode_bounds 03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.62_FULL_PASS - Logger Initialized (Import Phase).
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] -    Not running in Google Colab environment (get_ipython is None).
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.62_FULL_PASS
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log setup --------------------------------
03:48:16 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:16 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:16 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
03:48:16 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:16 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:16 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:16 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:16 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 10 (Original Part 9): Walk-Forward Orchestration & Analysis Functions (Fuller Logic v4.9.18 - Corrected WFV Type Hint) Loaded and Refactored.
03:48:16 - INFO - [GoldAI_Enterprise_v4.9] - Part 11 (Original Part 10): Main Execution & Pipeline Control Loaded and Refactored with Full Data/Model Logic.
03:48:16 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:16 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:16 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:16 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
-------------------------------- live log call ---------------------------------
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'min_lot': 0.01, 'max_lot': 0.1, 'point_value': 0.1}
03:48:16 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode] Calculating lot: MM Mode='balanced', Risk%=0.0200, Equity=$50000.00, ATR=1.00000, SL Delta Price=1.00000
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode]    Risk USD for trade: $1000.00
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode]    Total risk in USD for one min_lot (0.01) with SL $1.00: $0.10000
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode]    Raw lot size calculated (num_min_lots * min_lot): 100.0000
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode]    Adjusted lot (balanced, no change from raw): 100.0000
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode]    Lot after rounding down to min_lot multiple: 100.0000
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode]    Lot after min/max capping: 0.1000
03:48:16 [INFO] [gold_ai2025.calculate_lot_by_fund_mode]    [LotCalc] Final Lot Size: 0.10 (MM Mode: 'balanced', Risk: 2.00%, Equity: $50000)
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode] Calculating lot: MM Mode='balanced', Risk%=0.0200, Equity=$0.00, ATR=1.00000, SL Delta Price=1.00000
03:48:16 [WARNING] [gold_ai2025.calculate_lot_by_fund_mode] Equity is zero or negative. Returning min_lot.
03:48:16 [DEBUG] [gold_ai2025.calculate_lot_by_fund_mode] Calculating lot: MM Mode='balanced', Risk%=0.0200, Equity=$1000.00, ATR=1.00000, SL Delta Price=0.00000
03:48:16 [WARNING] [gold_ai2025.calculate_lot_by_fund_mode] SL delta price is near zero (0.00000). Returning min_lot.
PASSED
test_gold_ai.py::TestWFVandLotSizing::test_run_all_folds_with_threshold_mocked 
-------------------------------- live log call ---------------------------------
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'n_walk_forward_splits': 2, 'initial_capital': 100.0}
03:48:16 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:16 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:16 [INFO] [gold_ai2025.RiskManager] RiskManager initialized. Hard Kill DD: 20.00%, Soft Kill DD: 15.00%
03:48:16 [INFO] [gold_ai2025.TradeManager] TradeManager initialized. FE Cooldown: 240 min, FE Score: 1.0, FE Max Losses: 2
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]       [Runner (Prep Data - Fund: FALLBACK_FUND)] Starting Full WF Sim (L1_Th=0.55) for 2 folds.
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    RiskManager and TradeManager states reset for WFV execution of Fund: FALLBACK_FUND
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold] 
--- Processing Fold_1_FALLBACK_FUND (Train size: 2, Test size: 1) ---
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Using Gain_Z Threshold for Fold_1_FALLBACK_FUND: 0.300
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Calculating entry signals for Fold_1_FALLBACK_FUND using its specific fold_config...
03:48:16 [DEBUG] [gold_ai2025.run_all_folds_with_threshold]    Test data for Fold_1_FALLBACK_FUND after signal calculation: (1, 13)
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Simulating BUY for Fold_1_FALLBACK_FUND...
03:48:16 [INFO] [gold_ai2025.calculate_metrics.Fold_1_FALLBACK_FUND BUY]   (Metrics) Calculating full metrics for: 'Fold_1_FALLBACK_FUND BUY'...
03:48:16 [INFO] [gold_ai2025.calculate_metrics.Fold_1_FALLBACK_FUND BUY]   (Metrics) Finished calculating full metrics for: 'Fold_1_FALLBACK_FUND BUY'.
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Finished BUY for Fold_1_FALLBACK_FUND. Final Equity: $101.00, Trades: 1
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Simulating SELL for Fold_1_FALLBACK_FUND...
03:48:16 [INFO] [gold_ai2025.calculate_metrics.Fold_1_FALLBACK_FUND SELL]   (Metrics) Calculating full metrics for: 'Fold_1_FALLBACK_FUND SELL'...
03:48:16 [INFO] [gold_ai2025.calculate_metrics.Fold_1_FALLBACK_FUND SELL]   (Metrics) Finished calculating full metrics for: 'Fold_1_FALLBACK_FUND SELL'.
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Finished SELL for Fold_1_FALLBACK_FUND. Final Equity: $101.00, Trades: 1
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold] 
--- Processing Fold_2_FALLBACK_FUND (Train size: 3, Test size: 1) ---
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Using Gain_Z Threshold for Fold_2_FALLBACK_FUND: 0.300
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Calculating entry signals for Fold_2_FALLBACK_FUND using its specific fold_config...
03:48:16 [DEBUG] [gold_ai2025.run_all_folds_with_threshold]    Test data for Fold_2_FALLBACK_FUND after signal calculation: (1, 13)
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Simulating BUY for Fold_2_FALLBACK_FUND...
03:48:16 [INFO] [gold_ai2025.calculate_metrics.Fold_2_FALLBACK_FUND BUY]   (Metrics) Calculating full metrics for: 'Fold_2_FALLBACK_FUND BUY'...
03:48:16 [INFO] [gold_ai2025.calculate_metrics.Fold_2_FALLBACK_FUND BUY]   (Metrics) Finished calculating full metrics for: 'Fold_2_FALLBACK_FUND BUY'.
03:48:16 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Finished BUY for Fold_2_FALLBACK_FUND. Final Equity: $102.00, Trades: 1
03:48:17 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Simulating SELL for Fold_2_FALLBACK_FUND...
03:48:17 [INFO] [gold_ai2025.calculate_metrics.Fold_2_FALLBACK_FUND SELL]   (Metrics) Calculating full metrics for: 'Fold_2_FALLBACK_FUND SELL'...
03:48:17 [INFO] [gold_ai2025.calculate_metrics.Fold_2_FALLBACK_FUND SELL]   (Metrics) Finished calculating full metrics for: 'Fold_2_FALLBACK_FUND SELL'.
03:48:17 [INFO] [gold_ai2025.run_all_folds_with_threshold]    Finished SELL for Fold_2_FALLBACK_FUND. Final Equity: $102.00, Trades: 1
03:48:17 [INFO] [gold_ai2025.run_all_folds_with_threshold] 
--- Completed All 2 Folds for Fund: FALLBACK_FUND ---
03:48:17 [INFO] [gold_ai2025.calculate_metrics.Overall WF Buy (FALLBACK_FUND)]   (Metrics) Calculating full metrics for: 'Overall WF Buy (FALLBACK_FUND)'...
03:48:17 [INFO] [gold_ai2025.calculate_metrics.Overall WF Buy (FALLBACK_FUND)]   (Metrics) Finished calculating full metrics for: 'Overall WF Buy (FALLBACK_FUND)'.
03:48:17 [INFO] [gold_ai2025.calculate_metrics.Overall WF Sell (FALLBACK_FUND)]   (Metrics) Calculating full metrics for: 'Overall WF Sell (FALLBACK_FUND)'...
03:48:17 [INFO] [gold_ai2025.calculate_metrics.Overall WF Sell (FALLBACK_FUND)]   (Metrics) Finished calculating full metrics for: 'Overall WF Sell (FALLBACK_FUND)'.
03:48:17 [INFO] [gold_ai2025.run_all_folds_with_threshold] --- Finished WFV Simulation for Fund: FALLBACK_FUND ---
PASSED
test_gold_ai.py::TestWFVandLotSizing::test_simulate_trades_multi_order_with_reentry 
-------------------------------- live log call ---------------------------------
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0}
03:48:17 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:17 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:17 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000.0, Exit:1000.0, PNL:0.0
03:48:17 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestTP2AndBESL::test_besl_trigger 03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.62_FULL_PASS - Logger Initialized (Import Phase).
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] -    Not running in Google Colab environment (get_ipython is None).
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.62_FULL_PASS
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log setup --------------------------------
03:48:18 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:18 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:18 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
03:48:18 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 10 (Original Part 9): Walk-Forward Orchestration & Analysis Functions (Fuller Logic v4.9.18 - Corrected WFV Type Hint) Loaded and Refactored.
03:48:18 - INFO - [GoldAI_Enterprise_v4.9] - Part 11 (Original Part 10): Main Execution & Pipeline Control Loaded and Refactored with Full Data/Model Logic.
03:48:18 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:18 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:18 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:18 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
-------------------------------- live log call ---------------------------------
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'base_tp_multiplier': 1.5, 'base_be_sl_r_threshold': 1.0, 'default_sl_multiplier': 1.0, 'enable_be_sl': True, 'enable_partial_tp': False}
03:48:18 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:18 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:995, PNL:0.0
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
=== trade_log for BE-SL debug ===
entry_idx
entry_time
entry_price
stop_loss
take_profit
side
exit_price
exit_reason
exit_idx
exit_time
pnl_usd_net
FAILED
test_gold_ai.py::TestTP2AndBESL::test_partial_tp2_trigger 
-------------------------------- live log call ---------------------------------
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'enable_partial_tp': True, 'partial_tp_levels': [{'r_multiple': 0.8, 'close_pct': 0.5}, {'r_multiple': 1.2, 'close_pct': 0.5}], 'partial_tp_move_sl_to_entry': False, 'base_tp_multiplier': 2.0, 'default_sl_multiplier': 1.0}
03:48:18 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:18 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestTP2AndBESL::test_simulate_trades_tsl_tp_be_sl 
-------------------------------- live log call ---------------------------------
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'use_tsl': True, 'trailing_sl_distance': 1.5, 'base_tp_multiplier': 1.5, 'default_sl_multiplier': 1.0, 'base_be_sl_r_threshold': 1.0, 'enable_partial_tp': True, 'partial_tp_levels': [{'r_multiple': 0.5, 'close_pct': 0.5}], 'partial_tp_move_sl_to_entry': True}
03:48:19 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:19 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestTP2AndBESL::test_simulate_trades_with_kill_switch_activation 
-------------------------------- live log call ---------------------------------
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.5, 'initial_capital': 10.0, 'kill_switch_dd': 0.1, 'kill_switch_consecutive_losses': 1, 'recovery_mode_consecutive_losses': 1}
03:48:19 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.500, Max Hold: 24 bars, Kill DD: 10.00%
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:19 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] Triggered SL: {'entry_idx': 0, 'entry_time': Timestamp('2023-01-01 00:00:00'), 'entry_price': 1000, 'stop_loss': 998.5, 'take_profit': 1002.7, 'side': 'BUY', 'exit_price': 998.5, 'exit_reason': 'SL', 'exit_idx': 0, 'exit_time': Timestamp('2023-01-01 00:00:00'), 'pnl_usd_net': -1.5}
03:48:19 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] Kill switch activated at bar 0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
PASSED
test_gold_ai.py::TestWFVandLotSizingFix::test_multi_order_reentry_succeeds 03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.62_FULL_PASS - Logger Initialized (Import Phase).
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] -    Not running in Google Colab environment (get_ipython is None).
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.62_FULL_PASS
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log setup --------------------------------
03:48:19 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:19 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:19 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
03:48:19 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 10 (Original Part 9): Walk-Forward Orchestration & Analysis Functions (Fuller Logic v4.9.18 - Corrected WFV Type Hint) Loaded and Refactored.
03:48:19 - INFO - [GoldAI_Enterprise_v4.9] - Part 11 (Original Part 10): Main Execution & Pipeline Control Loaded and Refactored with Full Data/Model Logic.
03:48:19 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:19 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:19 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:19 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
-------------------------------- live log call ---------------------------------
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0, 'risk_per_trade': 0.01}
03:48:19 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:19 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000.0, Exit:999.0, PNL:0.0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:2, Side:BUY, Entry:1003.0, Exit:1000.0, PNL:0.0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestWFVandLotSizingFix::test_simulate_trades_BE_SL_multi 
-------------------------------- live log call ---------------------------------
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0, 'risk_per_trade': 0.01}
03:48:20 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:20 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:1, Side:BUY, Entry:1002, Exit:1001, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:2, Side:BUY, Entry:1004, Exit:1003, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED
test_gold_ai.py::TestWFVandLotSizingFix::test_simulate_trades_multi_order_strict 
-------------------------------- live log call ---------------------------------
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0, 'risk_per_trade': 0.01}
03:48:20 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:20 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:1, Side:BUY, Entry:1001, Exit:1000, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
FAILED

=================================== FAILURES ===================================
__________________ TestEdgeCases.test_simulate_trades_minimal __________________
test_gold_ai.py:767: in test_simulate_trades_minimal
    self.assertIsInstance(trade_log, list)
E   AssertionError:    entry_idx entry_time  entry_price  ...  exit_idx  exit_time pnl_usd_net
E   0          0 2023-01-01       1800.0  ...         0 2023-01-01         0.0
E   
E   [1 rows x 11 columns] is not an instance of <class 'list'>
------------------------------ Captured log call -------------------------------
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01}
03:48:13 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:13 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:13 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:13 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1800.0, Exit:1795.0, PNL:0.0
03:48:13 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
__________________ TestEdgeCases.test_simulate_trades_tp1_sl ___________________
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3805: in get_loc
    return self._engine.get_loc(casted_key)
index.pyx:167: in pandas._libs.index.IndexEngine.get_loc
    ???
index.pyx:196: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/hashtable_class_helper.pxi:7081: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
pandas/_libs/hashtable_class_helper.pxi:7089: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
E   KeyError: 0

The above exception was the direct cause of the following exception:
test_gold_ai.py:794: in test_simulate_trades_tp1_sl
    self.assertIn(trade_log[0]["exit_reason"], {"TP", "SL", "BE-SL"})
/usr/local/lib/python3.11/dist-packages/pandas/core/frame.py:4102: in __getitem__
    indexer = self.columns.get_loc(key)
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3812: in get_loc
    raise KeyError(key) from err
E   KeyError: 0
------------------------------ Captured log call -------------------------------
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01}
03:48:14 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:14 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:14 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:14 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999.0, PNL:0.0
03:48:14 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
_______________ TestEdgeCases.test_simulate_trades_tsl_behavior ________________
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3805: in get_loc
    return self._engine.get_loc(casted_key)
index.pyx:167: in pandas._libs.index.IndexEngine.get_loc
    ???
index.pyx:196: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/hashtable_class_helper.pxi:7081: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
pandas/_libs/hashtable_class_helper.pxi:7089: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
E   KeyError: 0

The above exception was the direct cause of the following exception:
test_gold_ai.py:823: in test_simulate_trades_tsl_behavior
    self.assertIn(trade_log[0]["exit_reason"], {"TSL", "TP", "BE-SL", "SL"})
/usr/local/lib/python3.11/dist-packages/pandas/core/frame.py:4102: in __getitem__
    indexer = self.columns.get_loc(key)
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3812: in get_loc
    raise KeyError(key) from err
E   KeyError: 0
------------------------------ Captured log call -------------------------------
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'use_tsl': True, 'trailing_sl_distance': 1.5}
03:48:15 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:15 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:15 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:15 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:15 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
______ TestWFVandLotSizing.test_simulate_trades_multi_order_with_reentry _______
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3805: in get_loc
    return self._engine.get_loc(casted_key)
index.pyx:167: in pandas._libs.index.IndexEngine.get_loc
    ???
index.pyx:196: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/hashtable_class_helper.pxi:7081: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
pandas/_libs/hashtable_class_helper.pxi:7089: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
E   KeyError: 0

The above exception was the direct cause of the following exception:
test_gold_ai.py:994: in test_simulate_trades_multi_order_with_reentry
    self.assertIn(trade_log[0]["exit_reason"], {"TP", "TSL", "BE-SL", "SL"})
/usr/local/lib/python3.11/dist-packages/pandas/core/frame.py:4102: in __getitem__
    indexer = self.columns.get_loc(key)
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3812: in get_loc
    raise KeyError(key) from err
E   KeyError: 0
------------------------------ Captured log call -------------------------------
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0}
03:48:17 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:17 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:17 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:17 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000.0, Exit:1000.0, PNL:0.0
03:48:17 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
_______________________ TestTP2AndBESL.test_besl_trigger _______________________
test_gold_ai.py:1157: in test_besl_trigger
    self.assertTrue(any(t["exit_reason"] in {"BE-SL", "SL"} for t in trade_log))
test_gold_ai.py:1157: in <genexpr>
    self.assertTrue(any(t["exit_reason"] in {"BE-SL", "SL"} for t in trade_log))
E   TypeError: string indices must be integers, not 'str'
------------------------------ Captured log setup ------------------------------
03:48:18 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:18 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:18 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:18 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:18 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:18 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:18 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:18 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:18 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
------------------------------ Captured log call -------------------------------
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'base_tp_multiplier': 1.5, 'base_be_sl_r_threshold': 1.0, 'default_sl_multiplier': 1.0, 'enable_be_sl': True, 'enable_partial_tp': False}
03:48:18 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:18 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:995, PNL:0.0
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
___________________ TestTP2AndBESL.test_partial_tp2_trigger ____________________
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3805: in get_loc
    return self._engine.get_loc(casted_key)
index.pyx:167: in pandas._libs.index.IndexEngine.get_loc
    ???
index.pyx:196: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/hashtable_class_helper.pxi:7081: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
pandas/_libs/hashtable_class_helper.pxi:7089: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
E   KeyError: 0

The above exception was the direct cause of the following exception:
test_gold_ai.py:1124: in test_partial_tp2_trigger
    trade_log[0]["exit_reason"], {"TP", "SL", "PartialTP", "BE-SL"}
/usr/local/lib/python3.11/dist-packages/pandas/core/frame.py:4102: in __getitem__
    indexer = self.columns.get_loc(key)
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3812: in get_loc
    raise KeyError(key) from err
E   KeyError: 0
------------------------------ Captured log call -------------------------------
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'enable_partial_tp': True, 'partial_tp_levels': [{'r_multiple': 0.8, 'close_pct': 0.5}, {'r_multiple': 1.2, 'close_pct': 0.5}], 'partial_tp_move_sl_to_entry': False, 'base_tp_multiplier': 2.0, 'default_sl_multiplier': 1.0}
03:48:18 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:18 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:18 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:18 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
_______________ TestTP2AndBESL.test_simulate_trades_tsl_tp_be_sl _______________
test_gold_ai.py:1190: in test_simulate_trades_tsl_tp_be_sl
    self.assertTrue(any(t["exit_reason"] in {"TSL", "TP", "BE-SL"} for t in trade_log))
test_gold_ai.py:1190: in <genexpr>
    self.assertTrue(any(t["exit_reason"] in {"TSL", "TP", "BE-SL"} for t in trade_log))
E   TypeError: string indices must be integers, not 'str'
------------------------------ Captured log call -------------------------------
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'risk_per_trade': 0.01, 'use_tsl': True, 'trailing_sl_distance': 1.5, 'base_tp_multiplier': 1.5, 'default_sl_multiplier': 1.0, 'base_be_sl_r_threshold': 1.0, 'enable_partial_tp': True, 'partial_tp_levels': [{'r_multiple': 0.5, 'close_pct': 0.5}], 'partial_tp_move_sl_to_entry': True}
03:48:19 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:19 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
___________ TestWFVandLotSizingFix.test_multi_order_reentry_succeeds ___________
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3805: in get_loc
    return self._engine.get_loc(casted_key)
index.pyx:167: in pandas._libs.index.IndexEngine.get_loc
    ???
index.pyx:196: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/hashtable_class_helper.pxi:7081: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
pandas/_libs/hashtable_class_helper.pxi:7089: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
E   KeyError: 0

The above exception was the direct cause of the following exception:
test_gold_ai.py:1318: in test_multi_order_reentry_succeeds
    self.assertIn(trade_log[0]["exit_reason"], {"TP", "TSL", "BE-SL", "SL"})
/usr/local/lib/python3.11/dist-packages/pandas/core/frame.py:4102: in __getitem__
    indexer = self.columns.get_loc(key)
/usr/local/lib/python3.11/dist-packages/pandas/core/indexes/base.py:3812: in get_loc
    raise KeyError(key) from err
E   KeyError: 0
------------------------------ Captured log setup ------------------------------
03:48:19 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
03:48:19 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
03:48:19 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
03:48:19 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
03:48:19 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
03:48:19 [INFO] [gold_ai2025.MT5Connector] Loading Part 12: MT5 Connector (Placeholder)...
03:48:19 [INFO] [gold_ai2025.MT5Connector] Part 12: MT5 Connector (Placeholder) Loaded.
03:48:19 [DEBUG] [gold_ai2025.Part14_FutureAdditions] Part 14: Placeholder for Future Additions reached.
03:48:19 [INFO] [gold_ai2025.Part15_EndOfScript] Reached End of Part 15 (Definitive End of Script Marker). Gold AI script processing complete.
------------------------------ Captured log call -------------------------------
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0, 'risk_per_trade': 0.01}
03:48:19 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:19 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:19 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000.0, Exit:999.0, PNL:0.0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:2, Side:BUY, Entry:1003.0, Exit:1000.0, PNL:0.0
03:48:19 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
___________ TestWFVandLotSizingFix.test_simulate_trades_BE_SL_multi ____________
test_gold_ai.py:1419: in test_simulate_trades_BE_SL_multi
    self.assertTrue(all(t['exit_reason'] in {"BE-SL", "SL", "TP"} for t in trade_log))
test_gold_ai.py:1419: in <genexpr>
    self.assertTrue(all(t['exit_reason'] in {"BE-SL", "SL", "TP"} for t in trade_log))
E   TypeError: string indices must be integers, not 'str'
------------------------------ Captured log call -------------------------------
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0, 'risk_per_trade': 0.01}
03:48:20 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:20 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:1, Side:BUY, Entry:1002, Exit:1001, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:2, Side:BUY, Entry:1004, Exit:1003, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
________ TestWFVandLotSizingFix.test_simulate_trades_multi_order_strict ________
test_gold_ai.py:1352: in test_simulate_trades_multi_order_strict
    exit_reasons = set(t['exit_reason'] for t in trade_log)
test_gold_ai.py:1352: in <genexpr>
    exit_reasons = set(t['exit_reason'] for t in trade_log)
E   TypeError: string indices must be integers, not 'str'
------------------------------ Captured log call -------------------------------
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig] Initializing StrategyConfig with dict: {'use_reentry': True, 'reentry_cooldown_bars': 0, 'reentry_cooldown_after_tp_minutes': 0, 'initial_capital': 100.0, 'risk_per_trade': 0.01}
03:48:20 [INFO] [gold_ai2025.StrategyConfig] StrategyConfig initialized. Risk/Trade: 0.010, Max Hold: 24 bars, Kill DD: 20.00%
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Feature Eng Params: M15 EMA Fast=50, M1 Rolling Z Window=300
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Default Signal Thresh: GainZ=0.3, RSI Buy=50
03:48:20 [DEBUG] [gold_ai2025.StrategyConfig]   Dynamic TP2 Params: HighVolBoost=1.2, LotBoostMult=1.1
03:48:20 [INFO] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.26] simulate_trades start
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:0, Side:BUY, Entry:1000, Exit:999, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.28] Triggered BE-SL: OrderIdx:1, Side:BUY, Entry:1001, Exit:1000, PNL:0.0
03:48:20 [DEBUG] [gold_ai2025.simulate_trades] [Patch AI Studio v4.9.56+] Returning tuple for legacy/test compatibility
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.11.12-final-0 _______________

Name             Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------
gold_ai2025.py    3715   2560    952    112    27%   93, 99-132, 142, 145, 147-149, 168, 172-175, 191-196, 203-211, 221-239, 244-253, 266, 269, 272, 275, 285, 289, 293, 297, 310, 313, 316, 319, 322, 331, 334, 337, 340, 344, 347, 350, 364-365, 383->385, 385->387, 399->401, 401->405, 424-434, 445-544, 562-643, 737-754, 780, 794-796, 808, 813, 820, 824-825, 835, 840, 846, 852, 860, 867, 882, 890, 898-904, 921, 928, 950, 956, 967, 975, 984, 996, 1002, 1017-1022, 1024-1025, 1030, 1033-1035, 1038-1039, 1042-1043, 1048-1050, 1056, 1062, 1068, 1083-1112, 1117-1166, 1175-1176, 1179-1182, 1193->1194, 1195-1198, 1220-1223, 1231-1241, 1256-1262, 1272, 1274->1288, 1277->1274, 1284-1286, 1288->1307, 1297-1305, 1308-1310, 1318, 1322, 1325-1365, 1367->exit, 1368-1373, 1378, 1380->1384, 1382, 1385->1389, 1387, 1390->1395, 1393, 1402-1405, 1410->exit, 1411->1415, 1412->exit, 1413->1414, 1413->exit, 1415->exit, 1416->exit, 1417->exit, 1418->exit, 1420->1423, 1425-1436, 1445, 1449->1451, 1455-1517, 1536-1539, 1545->1549, 1547, 1552-1557, 1563->1567, 1565, 1569->1573, 1570->1569, 1571, 1574->1579, 1576-1577, 1581-1582, 1588-1589, 1594-1595, 1601-1608, 1617->1622, 1620, 1624-1631, 1634, 1638-1642, 1645-1646, 1661-1665, 1670-1671, 1673-1675, 1685, 1687->1716, 1688->1691, 1698->1704, 1705-1714, 1716->1733, 1724-1726, 1729-1731, 1734->1738, 1741, 1761, 1767-1770, 1772-1773, 1775-1777, 1780-1784, 1788-1792, 1804->1859, 1809-1814, 1817->1816, 1819->1821, 1821->1816, 1825-1828, 1830-1857, 1863, 1866->1889, 1868, 1873-1887, 1891, 1896-1897, 1899-1904, 1906->1912, 1910, 1915-1919, 1922, 1925, 1928-1938, 1954-2200, 2212-2232, 2241-2613, 2627, 2631-2632, 2635-2638, 2645, 2649, 2656, 2662-2830, 2837-3091, 3111, 3115-3119, 3122-3123, 3147-3148, 3180-3549, 3585, 3594, 3610-3670, 3675, 3710, 3731, 3733->3736, 3744, 3749-3753, 3758, 3763-3766, 3768-3769, 3772-3778, 3782-3784, 3789-3792, 3795, 3804-3843, 3852-3886, 3892-3893, 3895-3896, 3901-3903, 3908-3909, 3912-3913, 3915->3918, 3919, 3935-3939, 3943-3950, 3958->3966, 3967, 3980-4002, 4013, 4039-4041, 4045-4049, 4073, 4079, 4094-4120, 4135-4205, 4226-4285, 4307-4418, 4427-4507, 4516-4625, 4647, 4661, 4678, 4688-4689, 4710, 4715, 4722, 4726, 4729, 4732-5022, 5038, 5043->5081, 5045->5081, 5047, 5050, 5055, 5062-5068, 5082, 5096, 5106-5169, 5195, 5205-5339, 5360, 5363, 5383-5388, 5393, 5401->5403, 5405, 5407->5454, 5444, 5448, 5452, 5459, 5466, 5468, 5470->5489, 5482, 5489->5525, 5494, 5497->5525, 5499-5522, 5526, 5533-5680, 5693-5724, 5743, 5749-5753, 5755, 5773-5775, 5777-5792, 5794-5804, 5806-5807, 5809-5814, 5825, 5828, 5834, 5853, 5860, 5869, 5871->5983, 5873, 5876, 5884, 5902, 5911, 5915->5977, 5916, 5920, 5924, 5947->5949, 5952, 5958-5962, 5965->5970, 5968, 5972, 5975, 5978, 5981, 5998->6007, 6000, 6043, 6076, 6097, 6115-6649, 6659, 6664, 6672-6763, 6780-6888, 6902-7058, 7062, 7085-7086, 7089, 7093-7100, 7109, 7111->7226, 7113, 7116, 7118->7134, 7121->7134, 7134->7205, 7137, 7144-7149, 7154, 7157->7165, 7159-7160, 7162-7163, 7166, 7181-7190, 7192->7134, 7203, 7205->7223, 7209-7213, 7216->7205, 7221, 7223->7111, 7224, 7226->7239, 7228->7239, 7229->7239, 7251-7255, 7258->7262, 7268, 7287-7316, 7349->7350, 7351-7364, 7368
------------------------------------------------------------
TOTAL             3715   2560    952    112    27%
============================= slowest 10 durations =============================
1.00s call     test_gold_ai.py::TestEdgeCases::test_prepare_datetime_all_nat
0.90s call     test_gold_ai.py::TestGoldAIPart1SetupAndEnv::test_environment_is_colab_drive_mount_succeeds
0.68s call     test_gold_ai.py::TestWFVandLotSizing::test_run_all_folds_with_threshold_mocked
0.40s call     test_gold_ai.py::TestEdgeCases::test_prepare_datetime_duplicate_index
0.30s setup    test_gold_ai.py::TestWFVandLotSizing::test_calculate_lot_by_fund_mode_bounds
0.25s setup    test_gold_ai.py::TestGoldAI2025::test_all_module_functions_present
0.21s setup    test_gold_ai.py::TestEdgeCases::test_calculate_metrics_basic
0.18s setup    test_gold_ai.py::TestTP2AndBESL::test_besl_trigger
0.18s setup    test_gold_ai.py::TestWFVandLotSizingFix::test_multi_order_reentry_succeeds
0.15s call     test_gold_ai.py::TestEdgeCases::test_load_data_valid
=========================== short test summary info ============================
FAILED test_gold_ai.py::TestEdgeCases::test_simulate_trades_minimal - AssertionError:    entry_idx entry_time  entry_price  ...  exit_idx  exit_t...
FAILED test_gold_ai.py::TestEdgeCases::test_simulate_trades_tp1_sl - KeyError: 0
FAILED test_gold_ai.py::TestEdgeCases::test_simulate_trades_tsl_behavior - KeyError: 0
FAILED test_gold_ai.py::TestWFVandLotSizing::test_simulate_trades_multi_order_with_reentry - KeyError: 0
FAILED test_gold_ai.py::TestTP2AndBESL::test_besl_trigger - TypeError: string indices must be integers, not 'str'
FAILED test_gold_ai.py::TestTP2AndBESL::test_partial_tp2_trigger - KeyError: 0
FAILED test_gold_ai.py::TestTP2AndBESL::test_simulate_trades_tsl_tp_be_sl - TypeError: string indices must be integers, not 'str'
FAILED test_gold_ai.py::TestWFVandLotSizingFix::test_multi_order_reentry_succeeds - KeyError: 0
FAILED test_gold_ai.py::TestWFVandLotSizingFix::test_simulate_trades_BE_SL_multi - TypeError: string indices must be integers, not 'str'
FAILED test_gold_ai.py::TestWFVandLotSizingFix::test_simulate_trades_multi_order_strict - TypeError: string indices must be integers, not 'str'
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 10 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
======================== 10 failed, 46 passed in 13.69s ========================

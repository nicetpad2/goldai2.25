   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 46.1/46.1 kB 1.3 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 244.0/244.0 kB 9.4 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 40.6/40.6 kB 1.2 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.6/1.6 MB 26.4 MB/s eta 0:00:00
✅ เปลี่ยน Directory แล้ว: /content/drive/MyDrive/new
============================= test session starts ==============================
platform linux -- Python 3.11.12, pytest-8.3.5, pluggy-1.5.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /content/drive/MyDrive/new
configfile: pytest.ini
plugins: cov-6.1.1, mock-3.14.0, xdist-3.6.1, langsmith-0.3.42, anyio-4.9.0, typeguard-4.4.2
collecting ... 
----------------------------- live log collection ------------------------------
12:21:25 [INFO] [numexpr.utils] NumExpr defaulting to 2 threads.
collected 105 items                                                            

test_gold_ai.py::TestGoldAIPart1SetupAndEnv::test_environment_is_colab_drive_mount_succeeds 12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 & 3] Initial StreamHandler for logger configured. FileHandler deferred to main().
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.53_FULL_PASS - Logger Initialized (Import Phase).
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] -    Running in Google Colab environment.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] -    Attempting to mount Google Drive...
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] -    Google Drive mounted successfully.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.53_FULL_PASS
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log call ---------------------------------
12:21:26 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
12:21:26 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
12:21:26 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
12:21:26 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
12:21:26 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
FAILED
test_gold_ai.py::TestGoldAI2025::test_all_module_functions_present 12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Gold AI Script Version: 4.9.53_FULL_PASS - Logger Initialized (Import Phase).
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 1 (Manual)] Developer to review entire gold_ai2025.py for syntax errors.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 2 (Review)] Reviewing top-level imports and global scope code in gold_ai2025.py.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - 
(Processing) Setting up environment (Colab, GPU)...
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] -    Not running in Google Colab environment (get_ipython is None).
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 4] setup_gpu_acceleration() call deferred to __main__ block.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 1/15 (Setup, Imports, Globals) Loaded. Script Version: 4.9.53_FULL_PASS
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - [Patch - IMPORT ERROR FIX - Step 5 (Review)] Developer to review try-except ImportError blocks for specificity.

-------------------------------- live log setup --------------------------------
12:21:28 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
12:21:28 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
12:21:28 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 3 (New): Enterprise Classes & Config Loader Implemented with Feature Engineering and Default Signal Thresholds.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 4 (Original Part 3): Helper Functions (Setup, Utils, Font, Config) Loaded.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 5 (Original Part 4): Data Loading & Initial Preparation Functions Loaded.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 6 (Original Part 5): Feature Engineering & Indicator Calculation Functions Loaded and Refactored to use StrategyConfig.
12:21:28 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 7 (Original Part 6): Machine Learning Configuration & Helpers Loaded and Refactored.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - [Patch AI Studio v4.9.49+] Setting optuna.logging.set_verbosity(optuna.logging.WARNING)
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 8 (Original Part 7): Model Training Function Loaded and Refactored with Optuna Integration.
12:21:28 - INFO - [GoldAI_Enterprise_v4.9] - Part 9 (Original Part 8): Backtesting Engine (v4.9.23 - Added TSL/BE Helpers & _check_kill_switch) Loaded and Refactored.
ERROR
test_gold_ai.py::TestGoldAI2025::test_check_kill_switch_logic ERROR
test_gold_ai.py::TestGoldAI2025::test_check_margin_call ERROR
test_gold_ai.py::TestGoldAI2025::test_library_already_imported ERROR
test_gold_ai.py::TestGoldAI2025::test_library_import_fails_install_succeeds ERROR
test_gold_ai.py::TestGoldAI2025::test_load_app_config_not_found ERROR
test_gold_ai.py::TestGoldAI2025::test_load_app_config_success ERROR
test_gold_ai.py::TestGoldAI2025::test_load_config_from_yaml ERROR
test_gold_ai.py::TestGoldAI2025::test_log_library_version_info ERROR

==================================== ERRORS ====================================
______ ERROR at setup of TestGoldAI2025.test_all_module_functions_present ______
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
------------------------------ Captured log setup ------------------------------
12:21:28 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
12:21:28 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
12:21:28 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
12:21:28 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
12:21:28 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
________ ERROR at setup of TestGoldAI2025.test_check_kill_switch_logic _________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
___________ ERROR at setup of TestGoldAI2025.test_check_margin_call ____________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
________ ERROR at setup of TestGoldAI2025.test_library_already_imported ________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
_ ERROR at setup of TestGoldAI2025.test_library_import_fails_install_succeeds __
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
_______ ERROR at setup of TestGoldAI2025.test_load_app_config_not_found ________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
________ ERROR at setup of TestGoldAI2025.test_load_app_config_success _________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
_________ ERROR at setup of TestGoldAI2025.test_load_config_from_yaml __________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
________ ERROR at setup of TestGoldAI2025.test_log_library_version_info ________
test_gold_ai.py:259: in setUpClass
    cls.gold_ai = safe_import_gold_ai()
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
=================================== FAILURES ===================================
__ TestGoldAIPart1SetupAndEnv.test_environment_is_colab_drive_mount_succeeds ___
test_gold_ai.py:252: in test_environment_is_colab_drive_mount_succeeds
    mod = safe_import_gold_ai(ipython_ret=ipy, drive_mod=drive_module)
test_gold_ai.py:219: in safe_import_gold_ai
    exec(code_obj, module.__dict__)
gold_ai2025.py:5657: in <module>
    ???
E   RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025.WFVResult'>. Was __classcell__ propagated to type.__new__?
------------------------------ Captured log call -------------------------------
12:21:26 [INFO] [gold_ai2025.Part2_DeprecatedParams] Part 2: Core Parameters & Strategy Settings (DEPRECATED - Parameters now in StrategyConfig from YAML).
12:21:26 [WARNING] [gold_ai2025.Part2_DeprecatedParams] Part 2: Is DEPRECATED. All tunable strategy parameters should be managed by StrategyConfig.
12:21:26 [INFO] [gold_ai2025.Part2_DeprecatedParams] Any true constants (e.g., for feature engineering) will be defined in their relevant sections or Part 1.
12:21:26 [INFO] [gold_ai2025.MLHelpers] Loading Machine Learning Configuration & Helpers (v4.9.13 - Refined Model Switcher)...
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_CLASSIFIER (L1 Filter): True
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial USE_META_META_CLASSIFIER (L2 Filter): False
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial Optuna Hyperparameter Tuning Enabled: False
12:21:26 [INFO] [gold_ai2025.MLHelpers]   Initial Auto Threshold Tuning Enabled: False
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.11.12-final-0 _______________

Name             Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------
gold_ai2025.py    3598   3344    886      0     6%   88-129, 135-147, 151, 160-172, 183, 188-193, 198-209, 214-223, 236, 239, 242, 245, 255, 259, 263, 267, 280, 283, 286, 289, 292, 295, 298, 301, 304, 307, 310, 314, 317, 320, 324-335, 347-404, 415-514, 532-613, 707-724, 750, 764-766, 776-972, 981-1031, 1040-1075, 1080-1158, 1180-1477, 1496-1701, 1719-1898, 1914-2160, 2172-2192, 2201-2573, 2587, 2591-2592, 2595-2598, 2605, 2609, 2616, 2622-2790, 2797-3051, 3071, 3075-3079, 3082-3083, 3107-3108, 3140-3509, 3545, 3554, 3570-3670, 3683-3755, 3764-3803, 3812-3842, 3854-3882, 3898-3930, 3943-3976, 3995-4042, 4057-4083, 4098-4168, 4189-4248, 4270-4378, 4387-4467, 4476-4584, 4604-5099, 5125, 5135-5269, 5288-5454, 5461-5608, 5621-5652, 5671-7239
------------------------------------------------------------
TOTAL             3598   3344    886      0     6%
============================= slowest 10 durations =============================
0.82s call     test_gold_ai.py::TestGoldAIPart1SetupAndEnv::test_environment_is_colab_drive_mount_succeeds
0.29s setup    test_gold_ai.py::TestGoldAI2025::test_all_module_functions_present

(8 durations < 0.005s hidden.  Use -vv to show these durations.)
=========================== short test summary info ============================
FAILED test_gold_ai.py::TestGoldAIPart1SetupAndEnv::test_environment_is_colab_drive_mount_succeeds - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_all_module_functions_present - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_check_kill_switch_logic - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_check_margin_call - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_library_already_imported - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_library_import_fails_install_succeeds - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_load_app_config_not_found - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_load_app_config_success - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_load_config_from_yaml - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
ERROR test_gold_ai.py::TestGoldAI2025::test_log_library_version_info - RuntimeError: __class__ not set defining 'WFVResult' as <class 'gold_ai2025...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 10 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 failed, 9 errors in 12.43s =========================
